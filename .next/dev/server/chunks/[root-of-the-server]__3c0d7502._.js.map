{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/mirceaqq/portofoliu/app/blog/writeups.ts"],"sourcesContent":["export type WriteUpSection = {\n  title: string;\n  summary: string;\n  commands?: { label?: string; snippet: string }[];\n  findings?: string[];\n  loot?: string[];\n  takeaways?: string[];\n};\n\nexport type WriteUp = {\n  slug: string;\n  title: string;\n  target: string;\n  type: \"Machine\" | \"Challenge\";\n  difficulty: \"Easy\" | \"Medium\" | \"Hard\" | \"Insane\" | string;\n  os?: string;\n  status: \"Rooted\" | \"In progress\" | \"Draft\";\n  release?: string;\n  timeToRoot?: string;\n  cover?: string;\n  gallery?: string[];\n  createdAt?: string;\n  updatedAt?: string;\n  publishedAt?: string;\n  skills: string[];\n  tags: string[];\n  summary: string;\n  highlights: string[];\n  sections: WriteUpSection[];\n  loot?: string[];\n  external?: { label: string; href: string }[];\n  notes?: string;\n};\n\nexport const writeups: WriteUp[] = [\n];\n\nexport const writeupTemplate: WriteUp = {\n  slug: \"htb-machine-slug\",\n  title: \"Descriptive title\",\n  target: \"Hack The Box: Machine name\",\n  type: \"Machine\",\n  difficulty: \"Easy\",\n  os: \"Linux\",\n  status: \"Draft\",\n  release: new Date().toISOString().slice(0, 10),\n  timeToRoot: \"\",\n  cover: \"/blog/cover.png\",\n  gallery: [\"/blog/screenshot1.png\"],\n  skills: [\"enum\", \"exploit\"],\n  tags: [\"tag1\", \"tag2\"],\n  summary: \"One-liner of the path to root.\",\n  highlights: [\"Key thing 1\", \"Key thing 2\"],\n  sections: [\n    {\n      title: \"Recon\",\n      summary: \"What you saw and why it matters.\",\n      commands: [{ label: \"Scan\", snippet: \"nmap -sC -sV -oN scans/name.nmap <ip>\" }],\n      findings: [\"service detail\"],\n    },\n  ],\n  loot: [\"user flag\", \"root flag\"],\n  external: [{ label: \"HTB link\", href: \"https://app.hackthebox.com\" }],\n};\n"],"names":[],"mappings":";;;;;;AAkCO,MAAM,WAAsB,EAClC;AAEM,MAAM,kBAA2B;IACtC,MAAM;IACN,OAAO;IACP,QAAQ;IACR,MAAM;IACN,YAAY;IACZ,IAAI;IACJ,QAAQ;IACR,SAAS,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,GAAG;IAC3C,YAAY;IACZ,OAAO;IACP,SAAS;QAAC;KAAwB;IAClC,QAAQ;QAAC;QAAQ;KAAU;IAC3B,MAAM;QAAC;QAAQ;KAAO;IACtB,SAAS;IACT,YAAY;QAAC;QAAe;KAAc;IAC1C,UAAU;QACR;YACE,OAAO;YACP,SAAS;YACT,UAAU;gBAAC;oBAAE,OAAO;oBAAQ,SAAS;gBAAwC;aAAE;YAC/E,UAAU;gBAAC;aAAiB;QAC9B;KACD;IACD,MAAM;QAAC;QAAa;KAAY;IAChC,UAAU;QAAC;YAAE,OAAO;YAAY,MAAM;QAA6B;KAAE;AACvE"}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///home/mirceaqq/portofoliu/app/lib/writeups.ts"],"sourcesContent":["import { writeups as staticWriteups, type WriteUp } from \"../blog/writeups\";\n\nconst SUPABASE_URL = process.env.SUPABASE_URL;\nconst SUPABASE_SERVICE_ROLE_KEY = process.env.SUPABASE_SERVICE_ROLE_KEY;\nconst SUPABASE_TABLE = process.env.SUPABASE_TABLE || \"writeups\";\n\nconst supabaseEnabled = SUPABASE_URL && SUPABASE_SERVICE_ROLE_KEY;\n\n// In-memory fallback for local/dev when no Supabase is configured.\nlet memoryStore: WriteUp[] = [];\n\nconst sortWriteups = (list: WriteUp[]) =>\n  [...list].sort((a, b) => {\n    const aDate = a.publishedAt || a.release || a.updatedAt || a.createdAt || \"\";\n    const bDate = b.publishedAt || b.release || b.updatedAt || b.createdAt || \"\";\n    return new Date(bDate).getTime() - new Date(aDate).getTime();\n  });\n\nasync function supabaseRequest<T>(path: string, init: RequestInit = {}): Promise<T> {\n  if (!supabaseEnabled) throw new Error(\"Supabase not configured\");\n  const url = `${SUPABASE_URL}/rest/v1/${path}`;\n  const res = await fetch(url, {\n    ...init,\n    headers: {\n      apikey: SUPABASE_SERVICE_ROLE_KEY as string,\n      Authorization: `Bearer ${SUPABASE_SERVICE_ROLE_KEY}`,\n      \"Content-Type\": \"application/json\",\n      Prefer: \"return=representation\",\n      ...(init.headers || {}),\n    },\n    cache: \"no-store\",\n  });\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(`Supabase request failed: ${res.status} ${text}`);\n  }\n  return res.json() as Promise<T>;\n}\n\nasync function readStore(): Promise<WriteUp[]> {\n  if (supabaseEnabled) {\n    return supabaseRequest<WriteUp[]>(`${SUPABASE_TABLE}?select=*`);\n  }\n  return memoryStore;\n}\n\nasync function upsertStore(entry: WriteUp): Promise<WriteUp> {\n  if (supabaseEnabled) {\n    const [saved] = await supabaseRequest<WriteUp[]>(`${SUPABASE_TABLE}`, {\n      method: \"POST\",\n      body: JSON.stringify([entry]),\n      headers: { Prefer: \"resolution=merge-duplicates\" },\n    });\n    return saved ?? entry;\n  }\n  const idx = memoryStore.findIndex((i) => i.slug === entry.slug);\n  if (idx >= 0) memoryStore[idx] = entry;\n  else memoryStore.push(entry);\n  return entry;\n}\n\nasync function deleteFromStore(slug: string) {\n  if (supabaseEnabled) {\n    await supabaseRequest(`${SUPABASE_TABLE}?slug=eq.${encodeURIComponent(slug)}`, { method: \"DELETE\" });\n    return;\n  }\n  memoryStore = memoryStore.filter((item) => item.slug !== slug);\n}\n\nexport async function getAllWriteups(): Promise<WriteUp[]> {\n  const dynamicEntries = await readStore();\n  const mergedMap = new Map<string, WriteUp>();\n  for (const item of staticWriteups) mergedMap.set(item.slug, item);\n  for (const item of dynamicEntries) mergedMap.set(item.slug, item);\n  return sortWriteups(Array.from(mergedMap.values()));\n}\n\nexport async function upsertWriteup(entry: WriteUp) {\n  const now = new Date().toISOString();\n  const existing = (await readStore()).find((i) => i.slug === entry.slug);\n  const next: WriteUp = {\n    ...entry,\n    createdAt: entry.createdAt || existing?.createdAt || now,\n    updatedAt: now,\n    publishedAt: entry.status === \"Draft\" ? entry.publishedAt : entry.publishedAt || now,\n  };\n  const saved = await upsertStore(next);\n  return saved;\n}\n\nexport async function deleteWriteup(slug: string) {\n  await deleteFromStore(slug);\n}\n\nexport async function getWriteupBySlug(slug: string): Promise<WriteUp | undefined> {\n  const all = await getAllWriteups();\n  return all.find((item) => item.slug === slug);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 218, "column": 0}, "map": {"version":3,"sources":["file:///home/mirceaqq/portofoliu/app/api/writeups/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\n\nimport { upsertWriteup, getAllWriteups } from \"@/app/lib/writeups\";\nimport type { WriteUp } from \"@/app/blog/writeups\";\n\nconst API_KEY = process.env.BLOG_API_KEY || process.env.NEXT_PUBLIC_BLOG_KEY;\nconst isProd = process.env.NODE_ENV === \"production\";\n\nfunction requireAuth(req: Request) {\n  if (!API_KEY) return !isProd; // allow in dev if no key is set, block in prod\n  const headerKey = req.headers.get(\"x-api-key\");\n  return headerKey === API_KEY;\n}\n\nexport async function GET() {\n  const data = await getAllWriteups();\n  return NextResponse.json({ data });\n}\n\nexport async function POST(request: Request) {\n  if (!requireAuth(request)) {\n    return NextResponse.json({ error: \"unauthorized\" }, { status: 401 });\n  }\n  try {\n    const body = (await request.json()) as WriteUp;\n    if (!body || !body.slug || !body.title) {\n      return NextResponse.json({ error: \"slug si title sunt obligatorii\" }, { status: 400 });\n    }\n    const prepared: WriteUp = {\n      highlights: [],\n      sections: [],\n      tags: [],\n      skills: [],\n      status: \"Draft\",\n      type: \"Machine\",\n      difficulty: \"Easy\",\n      target: body.title,\n      summary: body.summary || \"\",\n      ...body,\n    };\n    const saved = await upsertWriteup(prepared);\n    return NextResponse.json({ ok: true, data: saved });\n  } catch (err) {\n    console.error(err);\n    return NextResponse.json({ error: \"Nu am putut salva\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;;;AAGA,MAAM,UAAU,QAAQ,GAAG,CAAC,YAAY,IAAI,QAAQ,GAAG,CAAC,oBAAoB;AAC5E,MAAM,SAAS,oDAAyB;AAExC,SAAS,YAAY,GAAY;IAC/B,IAAI,CAAC,SAAS,OAAO,CAAC,QAAQ,+CAA+C;IAC7E,MAAM,YAAY,IAAI,OAAO,CAAC,GAAG,CAAC;IAClC,OAAO,cAAc;AACvB;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM,IAAA,0IAAc;IACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE;IAAK;AAClC;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI,CAAC,YAAY,UAAU;QACzB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;IACA,IAAI;QACF,MAAM,OAAQ,MAAM,QAAQ,IAAI;QAChC,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK,KAAK,EAAE;YACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiC,GAAG;gBAAE,QAAQ;YAAI;QACtF;QACA,MAAM,WAAoB;YACxB,YAAY,EAAE;YACd,UAAU,EAAE;YACZ,MAAM,EAAE;YACR,QAAQ,EAAE;YACV,QAAQ;YACR,MAAM;YACN,YAAY;YACZ,QAAQ,KAAK,KAAK;YAClB,SAAS,KAAK,OAAO,IAAI;YACzB,GAAG,IAAI;QACT;QACA,MAAM,QAAQ,MAAM,IAAA,yIAAa,EAAC;QAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,MAAM;QAAM;IACnD,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoB,GAAG;YAAE,QAAQ;QAAI;IACzE;AACF"}}]
}